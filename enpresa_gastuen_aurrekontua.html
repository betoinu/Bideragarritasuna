<!doctype html>
<html lang="eu">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>IDarte · Enpresa Gastuen Aurrekontua</title>
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="wrap" role="application" aria-label="IDarte presupuesto adaptado">
        <!-- CABECERA -->
        <header class="brand" role="banner">
            <div class="logo">
                <img src="img/mi_nueva_textura_idarte.svg" alt="IDarte logotipo" class="idarte-logo">
            </div>
            <div class="meta">
                <h1><span data-i18n="header.title">IDarte · Euskadiko Diseinu Eskola Publikoa</span></h1>
                <p class="muted"><span data-i18n="header.subtitle">BARNE DISEINU GRADUA - Neurketak eta Aurrekontuak</span></p>
            </div>
            <div class="controls">
                <select id="language-select">
                    <option value="eu">Euskera</option>
                    <option value="es">Castellano</option>
                </select>
                <button class="btn primary" id="download-report-btn" data-i18n="button.download" onclick="generatePDFReport()">Deskargatu</button>
            </div>
        </header>

        <!-- CUERPO PRINCIPAL -->
        <main class="stage">
            <section class="stage-left" id="main-sheet">
                <!-- TABS -->
                <div class="tabs" role="tablist">
                    <button class="tab active"><span data-i18n="tab.lokal">1 · Lokal</span></button>
                    <button class="tab"><span data-i18n="tab.pertsonala">2 · Pertsonala</span></button>
                    <button class="tab"><span data-i18n="tab.ekoizpena">3 · Ekoizpena</span></button>
                    <button class="tab"><span data-i18n="tab.garraioa">4 · Garraioa</span></button>
                    <button class="tab"><span data-i18n="tab.hazkuntza">5 · Hazkuntza</span></button>
                    <button class="tab"><span data-i18n="tab.finantzaketa">6 · Finantzaketa</span></button>
                    <button class="tab"><span data-i18n="tab.prezioa">7 · Prezioa</span></button>
                </div>

                <!-- PANEL 1 · LOKALA -->
                <div id="lokala-sheet" class="panel">
                    <h2>1 · Lokalaren Gastu Finkoak eta Inbertsioak</h2>
                    <h3>A) Inbertsio amortizagarriak</h3>
                    <table class="data">
                        <thead>
                            <tr>
                                <th>Kontzeptua</th>
                                <th>Kostua (€)</th>
                                <th>Amortizazio Urteak</th>
                                <th>Urteko Amortizazioa</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="lokala-amortizable-body"></tbody>
                    </table>
                    <button class="btn small" onclick="addAmortizable('lokala')">+ Gehitu</button>

                    <h3>B) Gastu finkoak</h3>
                    <table class="data">
                        <thead>
                            <tr>
                                <th>Kontzeptua</th>
                                <th>Kostua (€)</th>
                                <th>Maiztasuna</th>
                                <th>Urteko Guztira</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="lokala-recurring-body"></tbody>
                    </table>
                    <button class="btn small" onclick="addRecurring('lokala')">+ Gehitu</button>
                </div>

                <!-- PANEL 2 · PERTSONALA -->
                <div id="pertsonala-sheet" class="panel" style="display:none">
                    <h2>2 · Pertsonalaren Gastuak</h2>
                    <table class="data">
                        <thead>
                            <tr>
                                <th>Lanpostua</th>
                                <th>Urteko Soldata Gordina</th>
                                <th>Gizarte Segurantza (%)</th>
                                <th>Guztira</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="personnel-body"></tbody>
                    </table>
                    <button class="btn small" onclick="addPerson()">+ Gehitu Langilea</button>
                </div>

                <!-- PANEL 3 · EKOIZPENA -->
                <div id="ekoizpena-sheet" class="panel" style="display:none">
                    <h2>3 · Ekoizpen Gastuak</h2>
                    <table class="data">
                        <thead>
                            <tr>
                                <th>Kontzeptua</th>
                                <th>Kostua (€)</th>
                                <th>Maiztasuna</th>
                                <th>Urteko Guztira</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="ekoizpena-recurring-body"></tbody>
                    </table>
                    <button class="btn small" onclick="addRecurring('ekoizpena')">+ Gehitu Gastua</button>
                </div>

                <!-- PANEL 4 · GARRAIOA -->
                <div id="garraioa-sheet" class="panel" style="display:none">
                    <h2>4 · Garraio eta Logistika Gastuak</h2>
                    <h3>A) Inbertsio amortizagarriak</h3>
                    <table class="data">
                        <thead>
                            <tr>
                                <th>Kontzeptua</th>
                                <th>Kostua (€)</th>
                                <th>Amortizazio Urteak</th>
                                <th>Urteko Amortizazioa</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="garraioa-amortizable-body"></tbody>
                    </table>
                    <button class="btn small" onclick="addAmortizable('garraioa')">+ Gehitu Inbertsioa</button>

                    <h3>B) Gastu finkoak</h3>
                    <table class="data">
                        <thead>
                            <tr>
                                <th>Kontzeptua</th>
                                <th>Kostua (€)</th>
                                <th>Maiztasuna</th>
                                <th>Urteko Guztira</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="garraioa-recurring-body"></tbody>
                    </table>
                    <button class="btn small" onclick="addRecurring('garraioa')">+ Gehitu Gastua</button>
                </div>

                <!-- PANEL 5 · HAZKUNTZA -->
                <div id="hazkuntza-sheet" class="panel" style="display:none">
                    <h2>5 · Hazkuntza eta Garapen Gastuak</h2>
                    <table class="data">
                        <thead>
                            <tr>
                                <th>Kontzeptua</th>
                                <th>Kostua (€)</th>
                                <th>Maiztasuna</th>
                                <th>Urteko Guztira</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="hazkuntza-recurring-body"></tbody>
                    </table>
                    <button class="btn small" onclick="addRecurring('hazkuntza')">+ Gehitu Gastua</button>
                </div>

                <!-- PANEL 6 · FINANTZAKETA (MEJORADO) -->
                <div id="finantzaketa-sheet" class="panel" style="display:none">
                    <h2>6 · Finantzaketa Estrategia</h2>
                    
                    <!-- Sección de Socios -->
                    <div class="section">
                        <h3>Aportaciones de Socios</h3>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px">
                            <div>
                                <p>Número de socios definidos: <span id="num-socios">3</span></p>
                                <button class="btn small" id="add-socio">+ Añadir Socio</button>
                                <button class="btn small" id="remove-socio">- Eliminar Socio</button>
                            </div>
                            <div>
                                <table class="data">
                                    <thead>
                                        <tr>
                                            <th>Socio</th>
                                            <th>Capital (€)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="socios-table-body">
                                        <tr>
                                            <td>Bazkide 1</td>
                                            <td><input type="number" value="0" min="0" class="capital-input" oninput="updateAll()"></td>
                                        </tr>
                                        <tr>
                                            <td>Bazkide 2</td>
                                            <td><input type="number" value="0" min="0" class="capital-input" oninput="updateAll()"></td>
                                        </tr>
                                        <tr>
                                            <td>Bazkide 3</td>
                                            <td><input type="number" value="0" min="0" class="capital-input" oninput="updateAll()"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Gastos -->
                    <div class="section">
                        <h3>Clasificación de Gastos</h3>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
                            <div>
                                <h4>Gastos Amortizables</h4>
                                <label for="gastos-amortizables">Total Gastos Amortizables (€)</label>
                                <input type="number" id="gastos-amortizables" value="0" min="0" oninput="updateAll()">
                            </div>
                            <div>
                                <h4>Gastos Anualizables</h4>
                                <label for="gastos-anualizables">Total Gastos Anualizables (€)</label>
                                <input type="number" id="gastos-anualizables" value="0" min="0" oninput="updateAll()">
                                <div style="margin-top:10px">
                                    <input type="checkbox" id="financiar-anualizables" onchange="updateAll()">
                                    <label for="financiar-anualizables" style="display:inline;margin-left:5px">Financiar gastos anualizables</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Socios Capitalistas -->
                    <div class="section">
                        <h3>Socios Capitalistas</h3>
                        <button class="btn small" id="add-capitalista">+ Añadir Socio Capitalista</button>
                        <table class="data" style="margin-top:10px">
                            <thead>
                                <tr>
                                    <th>Socio Capitalista</th>
                                    <th>Aportación (€)</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="capitalistas-table-body">
                                <!-- Las filas se añadirán dinámicamente -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Sección de Financiación Externa -->
                    <div class="section">
                        <h3>Financiación Externa</h3>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
                            <div>
                                <label for="necesidades-inversion">Necesidades de Inversión (€)</label>
                                <input type="number" id="necesidades-inversion" value="210127.5" min="0" step="0.01" oninput="updateAll()">
                                
                                <label for="tipo-prestamo" style="margin-top:10px">Tipo de Préstamo</label>
                                <select id="tipo-prestamo" onchange="updateAll()">
                                    <option value="standard">Préstamo Estándar</option>
                                    <option value="hipotecario">Préstamo Hipotecario</option>
                                    <option value="linea-credito">Línea de Crédito</option>
                                </select>
                            </div>
                            <div>
                                <label for="tae">TAE (%)</label>
                                <input type="number" id="tae" value="5" min="0" step="0.01" oninput="updateAll()">
                                
                                <label for="plazo" style="margin-top:10px">Plazo (años)</label>
                                <input type="number" id="plazo" value="5" min="1" oninput="updateAll()">
                            </div>
                        </div>
                        
                        <!-- Resultados de Cálculo -->
                        <div style="background:#f8f9fa;padding:15px;border-radius:5px;margin-top:20px">
                            <h4>Resumen de Financiación</h4>
                            <p>Total Aportado por Socios: <span id="total-socios">0</span> €</p>
                            <p>Total Aportado por Socios Capitalistas: <span id="total-capitalistas">0</span> €</p>
                            <p>Cantidad a Financiar: <span id="cantidad-financiar">210127.5</span> €</p>
                            <p>Cuota Mensual Estimada: <span id="cuota-mensual">0</span> €</p>
                        </div>
                    </div>
                </div>

                <!-- PANEL 7 · PREZIOA -->
                <div id="prezioa-sheet" class="panel" style="display:none">
                    <h2>7 · Lanorduaren Prezioa eta Mozkinak</h2>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                        <div>
                            <label for="corporate-tax">Sozietateen Zerga (%)</label>
                            <input id="corporate-tax" type="number" value="25" oninput="calculatePricing()" />
                            <label for="target-profit-margin">Helburuko Mozkin (%)</label>
                            <input id="target-profit-margin" type="number" value="20" oninput="calculatePricing()" />
                            <label for="employee-count">Langile kopurua</label>
                            <input id="employee-count" type="number" value="2" oninput="calculatePricing()" />
                            <label for="annual-hours-per-employee">Urteko orduak/lang</label>
                            <input id="annual-hours-per-employee" type="number" value="1600" oninput="calculatePricing()" />
                        </div>
                        <div>
                            <div class="card">
                                <h4>Urteko lan-orduak guzt.</h4>
                                <p id="total-available-hours" class="value">0</p>
                            </div>
                            <div class="card">
                                <h4>Gomendatutako orduko prezioa</h4>
                                <p id="suggested-hourly-rate" class="value">€ 0.00</p>
                            </div>
                            <div class="card">
                                <h4>Espero den mozkin garbia</h4>
                                <p id="expected-net-profit" class="value">€ 0.00</p>
                            </div>
                            <div class="card">
                                <h4>Fakturazio beharrezkoa</h4>
                                <p id="required-annual-revenue" class="value">€ 0.00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- COLUMNA DERECHA -->
            <aside class="sidebar">
                <div class="card">
                    <h4 data-i18n="summary.title">Laburpen Orokorra</h4>
                    <p class="muted" data-i18n="summary.subtitle">Aurrekontu globala</p>
                    <p id="total-operational-cost" class="value">€ 0.00</p>
                </div>
                <div class="card">
                    <div class="idarte-graphic">
                        <img src="img/fondo.png" alt="Detalle gráfico IDarte" loading="lazy">
                    </div>
                </div>
                <div class="card">
                    <h4 data-i18n="contact.title">Kontaktua</h4>
                    <p class="muted" data-i18n="contact.name">Josu Ayerbe Guarás, Barne Diseinuko Graduko irakaslea</p>
                    <p class="muted" data-i18n="contact.email">josuayerbe@idarte.eus</p>
                    <p class="muted">Portal de Betoño, 23 · Vitoria-Gasteiz</p>
                </div>
            </aside>
        </main>

        <footer class="siteinfo">
            <small data-i18n="footer.note">IDarte · Euskadiko Diseinu Eskola Publikoa — Escuela Pública de Diseño de Euskadi.</small>
        </footer>
    </div>

    <!-- Overlay de carga -->
    <div id="loading-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:9999">
        <div style="background:white;padding:20px;border-radius:8px;display:flex;flex-direction:column;align-items:center">
            <div style="width:48px;height:48px;border:6px solid #eee;border-top-color:var(--id-primary);border-radius:50%;animation:spin 1s linear infinite"></div>
            <p style="margin-top:12px;color:#111827" data-i18n="loading">Txostena prestatzen...</p>
        </div>
    </div>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }
    </style>
    <script src="js/logic.js"></script>
</body>
</html>
